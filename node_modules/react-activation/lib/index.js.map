{"version":3,"file":"index.js","sources":["../src/helpers/is/index.js","../src/core/context/reactContext.js","../src/core/context/FakeScopeContext.js","../src/core/context/index.js","../src/core/Freeze.js","../src/core/Bridge/Context/fixContext.js","../src/core/Bridge/Context/ProviderBridge.js","../src/core/Bridge/Context/ConsumerWrapper.js","../src/core/Bridge/Context/ConsumerBridge.js","../src/core/Bridge/Suspense.js","../src/core/Bridge/ErrorBoundary.js","../src/core/Bridge/index.js","../src/core/lifecycles.js","../src/core/Keeper.js","../src/core/AliveScope.js","../src/core/withAliveScope.js","../src/helpers/saveScrollPosition.js","../src/core/KeepAlive.js"],"sourcesContent":["// 值类型判断 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\nexport const isRegExp = (val) => val instanceof RegExp\n// 值类型判断 -------------------------------------------------------------\n","import createContext from 'create-react-context'\n\n// 整个 KeepAlive 功能的上下文，将 KeepAlive 的组件藏于其 Provider 中，保证其不会被卸载\nexport const aliveScopeContext = createContext()\nexport const {\n  Provider: AliveScopeProvider,\n  Consumer: AliveScopeConsumer,\n} = aliveScopeContext\n\n// KeepAlive 组件的上下文，实现缓存生命周期功能\nexport const aliveNodeContext = createContext()\nexport const {\n  Provider: AliveNodeProvider,\n  Consumer: AliveNodeConsumer,\n} = aliveNodeContext\n","import { Component, PureComponent } from 'react'\nimport { EventBus, run, debounce } from 'szfe-tools'\n\nexport const eventBus = new EventBus()\n\nexport class FakeScopeProvider extends Component {\n  static eventBus = eventBus\n  static currentContextValue = undefined\n\n  constructor(props) {\n    super(props)\n    FakeScopeProvider.currentContextValue = props.value\n  }\n\n  shouldComponentUpdate(nextProps) {\n    if (nextProps.value !== this.props.value) {\n      FakeScopeProvider.currentContextValue = nextProps.value\n      eventBus.emit('update', nextProps.value)\n    }\n\n    return (\n      nextProps.children !== this.props.children ||\n      nextProps.value !== this.props.value\n    )\n  }\n\n  render() {\n    const { children } = this.props\n    return children\n  }\n}\n\nexport class FakeScopeConsumer extends PureComponent {\n  state = {\n    context: FakeScopeProvider.currentContextValue,\n  }\n\n  constructor(props) {\n    super(props)\n    eventBus.on('update', this.updateListener)\n  }\n\n  updateListener = debounce((nextContextValue) => {\n    this.setState({\n      context: nextContextValue,\n    })\n  })\n\n  componentWillUnmount() {\n    eventBus.off('update', this.updateListener)\n  }\n\n  render() {\n    const { children } = this.props\n    const { context } = this.state\n    return run(children, undefined, context)\n  }\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport React, { useState, useContext, useEffect } from 'react'\nimport { run, debounce, isFunction } from 'szfe-tools'\n\nimport {\n  aliveScopeContext,\n  AliveScopeProvider as AliveScopeReactProvider,\n  AliveScopeConsumer as AliveScopeReactConsumer,\n  aliveNodeContext,\n  AliveNodeProvider,\n  AliveNodeConsumer,\n} from './reactContext'\nimport {\n  eventBus as fakeContextEventBus,\n  FakeScopeProvider,\n  FakeScopeConsumer,\n} from './FakeScopeContext'\n\nexport const useScopeContext = () => {\n  if (!isFunction(useContext)) {\n    return {}\n  }\n\n  const scopeReactContext = useContext(aliveScopeContext)\n\n  if (scopeReactContext) {\n    return scopeReactContext\n  }\n\n  const [context, setContext] = useState(FakeScopeProvider.currentContextValue)\n\n  useEffect(() => {\n    const updateListener = debounce(setContext)\n    fakeContextEventBus.on('update', updateListener)\n    return () => fakeContextEventBus.off('update', updateListener)\n  }, [])\n\n  return context\n}\n\nexport const AliveScopeProvider = ({ children, ...props }) => (\n  <AliveScopeReactProvider {...props}>\n    <FakeScopeProvider {...props}>{children}</FakeScopeProvider>\n  </AliveScopeReactProvider>\n)\nexport const AliveScopeConsumer = ({ children }) => (\n  <AliveScopeReactConsumer>\n    {(reactContext) =>\n      !!reactContext ? (\n        run(children, undefined, reactContext)\n      ) : (\n        <FakeScopeConsumer>{children}</FakeScopeConsumer>\n      )\n    }\n  </AliveScopeReactConsumer>\n)\nexport {\n  aliveScopeContext,\n  aliveNodeContext,\n  AliveNodeProvider,\n  AliveNodeConsumer,\n}\n","// Fork from react-freeze\r\n// https://github.com/software-mansion/react-freeze/blob/main/src/index.tsx\r\nimport React, { Component, Suspense, Fragment } from 'react'\r\n\r\n// function Suspender({ freeze, children }) {\r\n//   const promiseCache = useRef({}).current\r\n//   if (freeze && !promiseCache.promise) {\r\n//     promiseCache.promise = new Promise((resolve) => {\r\n//       promiseCache.resolve = resolve\r\n//     })\r\n//     throw promiseCache.promise\r\n//   } else if (freeze) {\r\n//     throw promiseCache.promise\r\n//   } else if (promiseCache.promise) {\r\n//     promiseCache.resolve()\r\n//     promiseCache.promise = undefined\r\n//   }\r\n\r\n//   return <Fragment>{children}</Fragment>\r\n// }\r\n\r\nclass Suspender extends Component {\r\n  promiseCache = {}\r\n  render() {\r\n    const { freeze, children } = this.props\r\n    const { promiseCache } = this\r\n\r\n    if (freeze && !promiseCache.promise) {\r\n      promiseCache.promise = new Promise((resolve) => {\r\n        promiseCache.resolve = resolve\r\n      })\r\n      throw promiseCache.promise\r\n    } else if (freeze) {\r\n      throw promiseCache.promise\r\n    } else if (promiseCache.promise) {\r\n      promiseCache.resolve()\r\n      promiseCache.promise = undefined\r\n    }\r\n\r\n    return <Fragment>{children}</Fragment>\r\n  }\r\n}\r\n\r\nexport default function Freeze({ freeze, children, placeholder = null }) {\r\n  return (\r\n    <Suspense fallback={placeholder}>\r\n      <Suspender freeze={freeze}>{children}</Suspender>\r\n    </Suspense>\r\n  )\r\n}","import React from 'react'\nimport createReactContext from 'create-react-context'\nimport { get, isString, isFunction, memoize, EventBus, isExist } from 'szfe-tools'\n\nimport { aliveScopeContext, aliveNodeContext } from '../../context'\n\nexport const fixedContext = []\nexport const updateListenerCache = new Map()\nexport const eventBus = new EventBus()\n\nexport const fixContext = memoize((ctx) => {\n  if (!isExist(ctx)) {\n    return\n  }\n\n  // 排除 KeepAlive 功能的上下文\n  if ([aliveScopeContext, aliveNodeContext].includes(ctx)) {\n    return\n  }\n  fixedContext.push(ctx)\n  setTimeout(() => eventBus.emit('update'))\n})\n\nexport const createContext = (defaultValue, calculateChangedBits) => {\n  const ctx = createReactContext(defaultValue, calculateChangedBits)\n\n  fixContext(ctx)\n  return ctx\n}\n\nconst tryFixCtx = memoize((type) => {\n  // 尝试读取 Provider 或 Consumer 中的 context 静态属性\n  const ctx = get(type, '_context') || get(type, 'context') // 16.3.0 版本为 context，之后为 _context\n\n  // 判断是否为 ReactContext 类型\n  if (get(ctx, '$$typeof') === get(aliveScopeContext, '$$typeof')) {\n    fixContext(ctx)\n  }\n})\n\nconst override = (configs) => {\n  configs.forEach(([host, ...methods]) => {\n    methods.forEach((method) => {\n      if (\n        !isFunction(get(host, method)) ||\n        get(host, [method, '_overridden'])\n      ) {\n        return\n      }\n      const originMethod = host[method].bind(host)\n      host[method] = (type, ...args) => {\n        if (!isString(type)) {\n          tryFixCtx(type)\n        }\n        return originMethod(type, ...args)\n      }\n      host[method]._overridden = true\n    })\n  })\n}\n\n/**\n * 通过覆写 React.createElement 方法来探测 Provider 或 Consumer 的创建，并攫取其中 context 主动进行修复\n * TODO：同时兼容 React 17+，目前仅默认兼容 React.createElement 方法\n * React 17+ 为 require('react/jsx-runtime') 或 require('react/jsx-dev-runtime') 的 jsx、jsxs、jsxDEV 方法\n * 但由于无法动态 require，暂未想到方式同时兼容\n * 若需兼容 17+，目前手法为\n *\n * autoFixContext(\n *   [require('react/jsx-runtime'), 'jsx', 'jsxs', 'jsxDEV'],\n *   [require('react/jsx-dev-runtime'), 'jsx', 'jsxs', 'jsxDEV']\n * )\n *\n * Note: 需注意 16.2.x 及以下版本不支持此方法\n */\nexport const autoFixContext = (...configs) => {\n  try {\n    override(configs)\n  } catch (err) {\n    console.warn('activation override failed:', err)\n  }\n}\n\nautoFixContext([React, 'createElement'])\n","import React, { PureComponent } from 'react'\nimport { run, isUndefined } from 'szfe-tools'\n\nexport default class ProviderBridge extends PureComponent {\n  unmount = null\n  constructor(props) {\n    super(props)\n\n    const { value: ctxValues } = props\n\n    if (ctxValues.length === 0) {\n      this.state = {\n        ctxValue: null,\n      }\n\n      return\n    }\n\n    const [{ ctx, value, onUpdate }] = ctxValues\n\n    this.state = {\n      ctxValue: value,\n    }\n\n    this.unmount = onUpdate((value) => {\n      this.setState({\n        ctxValue: value,\n      })\n    })\n  }\n\n  componentWillUnmount() {\n    run(this.unmount)\n  }\n\n  // componentDidCatch(error) {\n  //   console.error('ProviderBridge Error', error)\n  // }\n\n  render() {\n    const { value: ctxValues, children } = this.props\n\n    if (ctxValues.length === 0) {\n      return children\n    }\n\n    const { ctxValue } = this.state\n    const [{ ctx }, ...restValues] = ctxValues\n    const { Provider } = ctx\n\n    const nextChildren = !isUndefined(ctxValue) ? (\n      <Provider value={ctxValue}>{children}</Provider>\n    ) : (\n      children\n    )\n\n    // 递归 ProviderBridge 修复多个上下文\n    // 此处未考虑待修复上下文顺序问题，按先来后到顺序处理，但理论上不应存在顺序问题\n    return restValues.length > 0 ? (\n      <ProviderBridge value={restValues}>{nextChildren}</ProviderBridge>\n    ) : (\n      nextChildren\n    )\n  }\n}\n","import { Component } from 'react'\nimport { run, get, isUndefined } from 'szfe-tools'\n\nimport { updateListenerCache } from './fixContext'\n\n// 在 KeepAlive 位置使用待修复上下文的 Consumer 探测可能存在的上下文关系\n// 若成功捕获上下文则保存其内容，用以后续 Keeper 中上下文的重建\nexport default class ConsumerWrapper extends Component {\n  updateListener = null\n  ctxInfo = null\n  constructor(props) {\n    super(props)\n\n    const { value, ctx, id } = props\n    if (isUndefined(value)) {\n      return\n    }\n\n    // 因 Consumer 探测器存在于 KeepAlive 外层故会随着 KeepAlive 卸载\n    // componentWillUnmount 中保留了已生成的更新监听器\n    // 此处重新挂载后恢复与对应 Keeper 中 ProviderBridge 的联系\n    this.updateListener = get(updateListenerCache.get(ctx), id, new Map())\n    run(this.updateListener, 'forEach', (fn) => fn(value))\n    this.ctxInfo = {\n      ctx,\n      value,\n      // 注册上下文更新的监听，保证上下文更新时 Keeper 中 ProviderBridge 内容的同步\n      onUpdate: (updator) => {\n        this.updateListener.set(updator, updator)\n\n        // 返回更新监听器的注销方法\n        return () => this.updateListener.delete(updator)\n      },\n    }\n  }\n\n  componentWillUnmount() {\n    const { value, ctx, id } = this.props\n    if (isUndefined(value)) {\n      return\n    }\n\n    // 因 Consumer 探测器存在于 KeepAlive 外层故会随着 KeepAlive 卸载\n    // 此处保留其中已生成的更新监听器，用以在重新挂载后保持与对应 Keeper 中 ProviderBridge 的联系\n    updateListenerCache.set(ctx, {\n      ...get(updateListenerCache.get(ctx), undefined, {}),\n      [id]: this.updateListener,\n    })\n  }\n\n  // 利用 shouldComponentUpdate 尽早将上下文更新的咨询通知到对应 Keeper 中 ProviderBridge\n  // TODO: 改用 componentWillReceiveProps 更早地进行更新，需注意与 getDerivedStateFromProps 新生命周期的兼容及可能存在的死循环问题\n  shouldComponentUpdate({ value }) {\n    const { value: prevValue } = this.props\n    const shouldUpdate = prevValue !== value\n\n    if (shouldUpdate) {\n      run(this.updateListener, 'forEach', (fn) => fn(value))\n    }\n\n    return true\n  }\n\n  render() {\n    const { value, renderWrapper, renderContent, id } = this.props\n\n    return renderWrapper((ctx$$) =>\n      renderContent(isUndefined(value) ? ctx$$ : [...ctx$$, this.ctxInfo])\n    )\n  }\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport React, {\n  PureComponent,\n  useContext,\n  useRef,\n  useEffect,\n  useState,\n} from 'react'\nimport { run, get, nextTick, isUndefined, isFunction } from 'szfe-tools'\n\nimport ConsumerWrapper from './ConsumerWrapper'\nimport { fixedContext, eventBus, updateListenerCache } from './fixContext'\n\nconst fixedContextSnapshot = {}\n\n// 对 ConsumerWrapper 的递归结构，会在 devtool 中生成较深的嵌套结构，可用 hooks 消除嵌套结构\nclass RecursiveConsumerBridge extends PureComponent {\n  constructor(props) {\n    super(props)\n    const { id } = props\n\n    if (!fixedContextSnapshot[id]) {\n      fixedContextSnapshot[id] = [...fixedContext]\n    }\n  }\n\n  renderWrapper = (renderChildren) => {\n    const { id } = this.props\n\n    const renderWrapper = fixedContextSnapshot[id].reduce(\n      (render, ctx) => {\n        const { Consumer } = ctx\n\n        const renderWrapper = (renderContent) => (\n          <Consumer>\n            {(value) => (\n              <ConsumerWrapper\n                {...{\n                  value,\n                  ctx,\n                  renderWrapper: render,\n                  renderContent,\n                  id,\n                }}\n              />\n            )}\n          </Consumer>\n        )\n\n        return renderWrapper\n      },\n      (renderContent) => renderContent([])\n    )\n\n    return renderWrapper(renderChildren)\n  }\n\n  render() {\n    const { children: renderChildren } = this.props\n\n    return this.renderWrapper(renderChildren)\n  }\n}\n\n// 若支持 Hooks，就不需要递归了，相关实现解释可参考 ConsumerWrapper\n// function HooksConsumerBridge({ children: renderChildren, id }) {\n//   const [, setRenderKey] = useState(Math.random)\n\n//   useEffect(() => {\n//     // 渲染时若 fixedContext 列表更新，则需强制刷新\n//     const updateListener = () => setRenderKey(Math.random)\n//     eventBus.on('update', updateListener)\n//     return () => {\n//       eventBus.off('update', updateListener)\n//     }\n//   }, [])\n\n//   const context$$ = fixedContext\n//     .map((ctx) => {\n//       const value = useContext(ctx)\n//       const prevValueRef = useRef(value)\n//       const { current: updateListener } = useRef(\n//         get(updateListenerCache.get(ctx), id, new Map())\n//       )\n\n//       // 尽可能早地进行更新\n//       if (prevValueRef.current !== value) {\n//         nextTick(() => run(updateListener, 'forEach', (fn) => fn(value)))\n//       }\n//       prevValueRef.current = value\n\n//       useEffect(() => {\n//         return () => {\n//           if (isUndefined(value)) {\n//             return\n//           }\n\n//           updateListenerCache.set(ctx, {\n//             ...get(updateListenerCache.get(ctx), undefined, {}),\n//             [id]: updateListener,\n//           })\n//         }\n//       }, [])\n\n//       return {\n//         ctx,\n//         value,\n//         onUpdate: (fn) => {\n//           updateListener.set(fn, fn)\n\n//           return () => updateListener.delete(fn)\n//         },\n//       }\n//     })\n//     .filter(({ value }) => !isUndefined(value))\n\n//   return renderChildren(context$$)\n// }\n\n// fix #99\n// const ConsumerBridge = [useContext, useRef, useEffect].every(isFunction)\n//   ? HooksConsumerBridge\n//   : RecursiveConsumerBridge\n// fix #99\nexport default RecursiveConsumerBridge\n","import React, { lazy, Suspense, Component, Fragment } from 'react'\nimport { run, isUndefined, isFunction } from 'szfe-tools'\n\n// 兼容性检测\nconst isSupported = isFunction(lazy) && !isUndefined(Suspense)\nconst SusNotSupported = ({ children }) => run(children)\n\nconst Lazy = isSupported ? lazy(() => new Promise(() => null)) : () => null\n\nclass FallbackListener extends Component {\n  componentDidMount() {\n    run(this.props, 'onStart')\n  }\n\n  componentWillUnmount() {\n    run(this.props, 'onEnd')\n  }\n\n  render() {\n    return null\n  }\n}\n\nfunction SuspenseBridge({ children, sus$$ }) {\n  return (\n    // 捕获 Keeper 内部可能存在的 lazy，并触发对应 KeepAlive 位置上的 LazyBridge\n    <Suspense\n      fallback={\n        <FallbackListener\n          onStart={sus$$.onSuspenseStart}\n          onEnd={sus$$.onSuspenseEnd}\n        />\n      }\n    >\n      {children}\n    </Suspense>\n  )\n}\n\nexport const LazyBridge = isSupported\n  ? class LazyBridge extends Component {\n      state = {\n        suspense: false,\n      }\n\n      onSuspenseStart = () => {\n        this.setState({\n          suspense: true,\n        })\n      }\n\n      onSuspenseEnd = () => {\n        this.setState({\n          suspense: false,\n        })\n      }\n\n      sus$$ = {\n        onSuspenseStart: this.onSuspenseStart,\n        onSuspenseEnd: this.onSuspenseEnd,\n      }\n\n      render() {\n        const { children } = this.props\n\n        return (\n          <Fragment>\n            {run(children, undefined, this.sus$$)}\n            {/* 渲染 Lazy 以触发 KeepAlive 所处位置外部可能存在的 Suspense */}\n            {this.state.suspense && <Lazy />}\n          </Fragment>\n        )\n      }\n    }\n  : SusNotSupported\n\nexport default isSupported ? SuspenseBridge : SusNotSupported\n","import { Component } from 'react'\nimport { run } from 'szfe-tools'\n\nexport default class ErrorBoundaryBridge extends Component {\n  // Error Boundary 透传至对应 KeepAlive 实例位置\n  static getDerivedStateFromError = () => null\n  componentDidCatch(error) {\n    const { error$$: throwError } = this.props\n\n    run(throwError, undefined, error, () => {\n      run(throwError, undefined, null)\n    })\n  }\n\n  render() {\n    return this.props.children\n  }\n}\n\nexport class ErrorThrower extends Component {\n  state = {\n    error: null,\n  }\n\n  throwError = (error, cb) => this.setState({ error }, cb)\n  render() {\n    if (this.state.error) {\n      throw this.state.error\n    }\n\n    return run(this.props.children, undefined, this.throwError)\n  }\n}\n","import React from 'react'\nimport { run } from 'szfe-tools'\n\nimport { ProviderBridge, ConsumerBridge } from './Context'\nimport SuspenseBridge, { LazyBridge } from './Suspense'\nimport ErrorBoundaryBridge, { ErrorThrower } from './ErrorBoundary'\n\n// 用于 Keeper 中，实现 Keeper 向外或向内的桥接代理\nexport default function Bridge({ id, children, bridgeProps }) {\n  const { sus$$, ctx$$, error$$ } = bridgeProps\n\n  return (\n    /* 由内向外透传 componentDidCatch 捕获的 error */\n    <ErrorBoundaryBridge error$$={error$$}>\n      {/* 由内向外透传 lazy 行为 */}\n      <SuspenseBridge sus$$={sus$$}>\n        {/* 由外向内透传可能存在的 Consumer 数据 */}\n        <ProviderBridge id={id} value={ctx$$}>\n          {children}\n        </ProviderBridge>\n      </SuspenseBridge>\n    </ErrorBoundaryBridge>\n  )\n}\n\n// 用于 KeepAlive 中，实现 KeepAlive 向外或向内的桥接代理\nexport function Acceptor({ id, children }) {\n  return (\n    /* 由内向外透传 componentDidCatch 捕获的 error */\n    <ErrorThrower>\n      {(error$$) => (\n        /* 由内向外透传 lazy 行为 */\n        <LazyBridge>\n          {(sus$$) => (\n            /* 由外向内透传可能被捕获的 Provider 数据 */\n            <ConsumerBridge id={id}>\n              {(ctx$$) =>\n                run(children, undefined, {\n                  bridgeProps: {\n                    sus$$,\n                    ctx$$,\n                    error$$,\n                  },\n                })\n              }\n            </ConsumerBridge>\n          )}\n        </LazyBridge>\n      )}\n    </ErrorThrower>\n  )\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport React, {\n  Component,\n  forwardRef,\n  useEffect,\n  useRef,\n  useContext,\n} from 'react'\nimport hoistStatics from 'hoist-non-react-statics'\nimport {\n  get,\n  run,\n  nextTick,\n  isObject,\n  isFunction,\n  isUndefined,\n} from 'szfe-tools'\n\nimport { AliveNodeConsumer, aliveNodeContext } from './context'\n\nexport const LIFECYCLE_ACTIVATE = 'componentDidActivate'\nexport const LIFECYCLE_UNACTIVATE = 'componentWillUnactivate'\n\nexport const withActivation = (WrappedComponent) => {\n  class HOC extends Component {\n    drop = null\n\n    componentWillUnmount() {\n      run(this.drop)\n    }\n\n    render() {\n      const { forwardedRef, ...props } = this.props\n\n      return (\n        <AliveNodeConsumer>\n          {({ attach } = {}) => (\n            <WrappedComponent\n              ref={(ref) => {\n                if (\n                  [LIFECYCLE_ACTIVATE, LIFECYCLE_UNACTIVATE].every(\n                    (lifecycleName) => !isFunction(get(ref, lifecycleName))\n                  )\n                ) {\n                  return\n                }\n                this.drop = run(attach, undefined, ref)\n\n                // 以下保持 ref 功能\n                if (isUndefined(forwardedRef)) {\n                  return\n                }\n\n                if (isObject(forwardedRef) && 'current' in forwardedRef) {\n                  forwardedRef.current = ref\n                  return\n                }\n\n                run(forwardedRef, undefined, ref)\n              }}\n              {...props}\n            />\n          )}\n        </AliveNodeConsumer>\n      )\n    }\n  }\n\n  // 由于 KeepAlive 内组件渲染与实际内容落后一个节拍\n  // 将导致真实节点的 componentDidMount 无法及时获取到 KeepAlive 中内容的 ref 值\n  // 此处对使用了 withActivation HOC 的组件 componentDidMount 做 nextTick 延时处理\n  // 修复上述问题\n\n  if (isFunction(WrappedComponent.prototype.componentDidMount)) {\n    WrappedComponent.prototype._componentDidMount =\n      WrappedComponent.prototype.componentDidMount\n    WrappedComponent.prototype.componentDidMount = function componentDidMount() {\n      nextTick(() => WrappedComponent.prototype._componentDidMount.call(this))\n    }\n  }\n\n  if (isFunction(forwardRef)) {\n    const ForwardedRefHOC = forwardRef((props, ref) => (\n      <HOC {...props} forwardedRef={ref} />\n    ))\n\n    return hoistStatics(ForwardedRefHOC, WrappedComponent)\n  } else {\n    return hoistStatics(HOC, WrappedComponent)\n  }\n}\n\nconst useActivation = (funcName, func) => {\n  // 兼容性判断\n  if ([useRef, useContext, useEffect].some((fn) => !isFunction(fn))) {\n    return\n  }\n\n  const ctxValue = useContext(aliveNodeContext)\n\n  // 未处于 KeepAlive 中\n  if (!ctxValue) {\n    return\n  }\n\n  const { current: ref } = useRef({})\n  const { attach } = ctxValue\n\n  ref[funcName] = func\n  ref.drop = attach(ref)\n\n  useEffect(() => {\n    return () => run(ref.drop)\n  }, [])\n}\n\nexport const useActivate = useActivation.bind(null, LIFECYCLE_ACTIVATE)\nexport const useUnactivate = useActivation.bind(null, LIFECYCLE_UNACTIVATE)\n","import React, { PureComponent, Suspense } from 'react'\nimport { flushSync } from 'react-dom'\nimport { get, run, nextTick, EventBus } from 'szfe-tools'\n\nimport ReactFreeze from './Freeze'\nimport Bridge from './Bridge'\nimport { AliveNodeProvider } from './context'\nimport { LIFECYCLE_ACTIVATE, LIFECYCLE_UNACTIVATE } from './lifecycles'\n\nconst Freeze = !!Suspense ? ReactFreeze : ({ children }) => children\n\nexport default class Keeper extends PureComponent {\n  eventBus = new EventBus()\n  listeners = new Map()\n  wrapper = null\n\n  constructor(props, ...rest) {\n    super(props, ...rest)\n\n    this.state = {\n      children: props.children,\n      bridgeProps: props.bridgeProps,\n      key: Math.random(),\n      freeze: false,\n    }\n  }\n\n  cache = undefined\n  componentDidMount() {\n    const { store, id } = this.props\n    const listeners = this.listeners\n    const node = this.wrapper\n\n    // 已存在检测，防止意外现象\n    if (store.has(id)) {\n      return\n    }\n\n    let nodes\n    try {\n      nodes = [...node.children]\n    } catch (e) {\n      nodes = [node.children]\n    }\n\n    this.cache = {\n      listeners,\n      aliveNodesId: [],\n      inited: false,\n      cached: false,\n      wrapper: node,\n      nodes,\n      [LIFECYCLE_ACTIVATE]: () => this[LIFECYCLE_ACTIVATE](),\n      [LIFECYCLE_UNACTIVATE]: () => this[LIFECYCLE_UNACTIVATE](),\n    }\n\n    store.set(id, this.cache)\n  }\n\n  \n  unmounted = false\n  safeSetState = (nextState, callback) => {\n    // fix #170\n    if (this.unmounted) {\n      return\n    }\n    this.setState(nextState, callback)\n  }\n  componentWillUnmount() {\n    const { store, keepers, id } = this.props\n    // 卸载前尝试归位 DOM 节点\n    try {\n      const cache = store.get(id)\n      cache.nodes.forEach((node) => {\n        cache.wrapper.appendChild(node)\n      })\n    } catch (error) {\n      // console.error(error) // do nothing\n    }\n    store.delete(id)\n    keepers.delete(id)\n    this.unmounted = true\n  }\n\n  freezeTimeout = null\n\n  ;[LIFECYCLE_ACTIVATE]() {\n    clearTimeout(this.freezeTimeout)\n    // 激活后，立即解冻\n    this.safeSetState({\n      freeze: false,\n    })\n    this.eventBus.emit(LIFECYCLE_ACTIVATE)\n    this.listeners.forEach((listener) => run(listener, [LIFECYCLE_ACTIVATE]))\n  }\n\n  ;[LIFECYCLE_UNACTIVATE]() {\n    this.eventBus.emit(LIFECYCLE_UNACTIVATE)\n    const listeners = [...this.listeners]\n\n    listeners\n      .reverse()\n      .forEach(([, listener]) => run(listener, [LIFECYCLE_UNACTIVATE]))\n\n    // 缓存后，延迟冻结，保证各项后续处理得以进行，如关闭弹窗等\n    clearTimeout(this.freezeTimeout)\n    this.freezeTimeout = setTimeout(() => {\n      flushSync(() => {\n        this.safeSetState({\n          freeze: true,\n        })\n      })\n    }, 1000)\n  }\n\n  // // 原先打算更新过程中先重置 dom 节点状态，更新后恢复 dom 节点\n  // // 但考虑到性能消耗可能过大，且可能因 dom 操作时机引发其他 react 渲染问题，故不使用\n  // // 对应 KeepAlive 处 update 也注释起来不使用\n  // // 组件更新后，更新 DOM 节点列表状态\n  // componentDidUpdate() {\n  //   const { store, id } = this.props\n  //   const node = this.wrapper\n  //   if (get(node, 'children.length') > 0) {\n  //     store[id].nodes = [...node.children]\n  //   }\n\n  //   console.log(store[id].nodes)\n  // }\n\n  // 生命周期绑定\n  attach = (ref) => {\n    const listeners = this.listeners\n\n    if (!ref) {\n      return () => null\n    }\n\n    if (ref.isKeepAlive) {\n      nextTick(() => {\n        const { id, store } = this.props\n        const cache = store.get(id)\n        cache.aliveNodesId = new Set([...cache.aliveNodesId, ref.id])\n      })\n    }\n\n    listeners.set(ref, {\n      [LIFECYCLE_ACTIVATE]: () => run(ref, LIFECYCLE_ACTIVATE),\n      [LIFECYCLE_UNACTIVATE]: () => run(ref, LIFECYCLE_UNACTIVATE),\n    })\n\n    // 返回 listenerRemover 用以在对应组件卸载时解除监听\n    return () => {\n      listeners.delete(ref)\n    }\n  }\n\n  // 静态化节点上下文内容，防止重复渲染\n  contextValue = {\n    id: this.props.id,\n    attach: this.attach,\n  }\n\n  drop = ({ delay = 1200 } = {}) =>\n    new Promise((resolve) => {\n      let timeout\n      const { scope, id } = this.props\n      const drop = () => {\n        clearTimeout(timeout)\n        this.eventBus.off(LIFECYCLE_UNACTIVATE, drop)\n        // 用在多层 KeepAlive 同时触发 drop 时，避免触发深层 KeepAlive 节点的缓存生命周期\n        this.cache.willDrop = true\n        scope.nodes.delete(id)\n        scope.helpers = { ...scope.helpers }\n        scope.smartForceUpdate(() => resolve(true))\n      }\n\n      const canDrop = get(this.cache, 'cached') || get(this.cache, 'willDrop')\n      if (!canDrop) {\n        this.eventBus.on(LIFECYCLE_UNACTIVATE, drop)\n        timeout = setTimeout(() => {\n          this.eventBus.off(LIFECYCLE_UNACTIVATE, drop)\n          resolve(false)\n        }, delay)\n        return\n      }\n\n      drop()\n    })\n\n  refresh = () =>\n    new Promise((resolve) => {\n      const canRefresh = !get(this.cache, 'cached')\n      if (!canRefresh) {\n        resolve(false)\n      }\n      this.safeSetState(\n        {\n          key: Math.random(),\n        },\n        () => resolve(true)\n      )\n    })\n\n  render() {\n    const { id, autoFreeze = true, ...props } = this.props\n    const { children, bridgeProps, key, freeze } = this.state\n\n    return (\n      <Freeze freeze={autoFreeze && freeze}>\n        <div\n          ref={(node) => {\n            this.wrapper = node\n          }}\n        >\n          <div key=\"keeper-container\" nodeKeyIgnore className=\"ka-content\">\n            <Bridge id={id} bridgeProps={bridgeProps}>\n              <AliveNodeProvider value={this.contextValue}>\n                {React.Children.map(children, (child, idx) =>\n                  React.cloneElement(child, {\n                    key: `${child.key || ''}:${key}:${idx}`,\n                  })\n                )}\n              </AliveNodeProvider>\n            </Bridge>\n          </div>\n        </div>\n      </Freeze>\n    )\n  }\n}\n","import React, { Component } from 'react'\nimport { get, run, flatten, debounce, globalThis as root } from 'szfe-tools'\n\nimport { isRegExp } from '../helpers/is'\nimport { AliveScopeProvider } from './context'\nimport Keeper from './Keeper'\n\nconst HANDLE_TYPE_DROP = 'drop'\nconst HANDLE_TYPE_REFRESH = 'refresh'\n\nexport default class AliveScope extends Component {\n  store = new Map()\n  nodes = new Map()\n  keepers = new Map()\n\n  debouncedForceUpdate = debounce((cb) => this.forceUpdate(cb))\n  updateCallbackList = []\n  smartForceUpdate = (cb) => {\n    this.updateCallbackList.push(cb)\n    this.debouncedForceUpdate(() => {\n      this.updateCallbackList.forEach((cb) => run(cb))\n      this.updateCallbackList = []\n    })\n  }\n  update = (id, params) =>\n    new Promise((resolve) => {\n      const keeper = this.keepers.get(id)\n      const isNew = !keeper\n      const now = Date.now()\n      const node = this.nodes.get(id) || null\n      this.nodes.set(id, {\n        id,\n        createTime: now,\n        updateTime: now,\n        ...node,\n        ...params,\n      })\n\n      if (isNew) {\n        this.helpers = { ...this.helpers }\n\n        this.forceUpdate(resolve)\n      } else {\n        const { children, bridgeProps } = params\n        keeper.setState({ children, bridgeProps }, resolve)\n      }\n    })\n\n  keep = (id, params) =>\n    new Promise((resolve) => {\n      this.update(id, {\n        id,\n        ...params,\n      }).then(() => {\n        resolve(this.store.get(id))\n      })\n    })\n\n  getCachingNodesByName = (name) =>\n    this.getCachingNodes().filter((node) =>\n      isRegExp(name) ? name.test(node.name) : node.name === name\n    )\n\n  getScopeIds = (ids) => {\n    // 递归采集 scope alive nodes id\n    const getCachingNodesId = (id) => {\n      const aliveNodesId = get(this.getCache(id), 'aliveNodesId', [])\n\n      if (aliveNodesId.size > 0) {\n        return [id, [...aliveNodesId].map(getCachingNodesId)]\n      }\n\n      return [id, ...aliveNodesId]\n    }\n\n    return flatten(ids.map((id) => getCachingNodesId(id)))\n  }\n\n  dropById = (id, ...rest) => this.handleNodes([id], HANDLE_TYPE_DROP, ...rest)\n  dropScopeByIds = (ids, ...rest) =>\n    this.handleNodes(this.getScopeIds(ids), HANDLE_TYPE_DROP, ...rest)\n\n  drop = (name, ...rest) =>\n    this.handleNodes(\n      this.getCachingNodesByName(name).map((node) => node.id),\n      HANDLE_TYPE_DROP,\n      ...rest\n    )\n\n  dropScope = (name, ...rest) =>\n    this.dropScopeByIds(\n      this.getCachingNodesByName(name).map(({ id }) => id),\n      ...rest\n    )\n\n  refreshById = (id, ...rest) =>\n    this.handleNodes([id], HANDLE_TYPE_REFRESH, ...rest)\n  refreshScopeByIds = (ids, ...rest) =>\n    this.handleNodes(this.getScopeIds(ids), HANDLE_TYPE_REFRESH, ...rest)\n\n  refresh = (name, ...rest) =>\n    this.handleNodes(\n      this.getCachingNodesByName(name).map((node) => node.id),\n      HANDLE_TYPE_REFRESH,\n      ...rest\n    )\n\n  refreshScope = (name, ...rest) =>\n    this.refreshScopeByIds(\n      this.getCachingNodesByName(name).map(({ id }) => id),\n      ...rest\n    )\n\n  handleNodes = (nodesId, type = HANDLE_TYPE_DROP, ...rest) =>\n    new Promise((resolve) => {\n      const handleKeepers = []\n\n      nodesId.forEach((id) => {\n        const cache = this.store.get(id)\n\n        if (!cache) {\n          return\n        }\n\n        const keeper = this.keepers.get(id)\n        handleKeepers.push(keeper)\n      })\n\n      if (handleKeepers.length === 0) {\n        resolve(false)\n        return\n      }\n\n      Promise.all(\n        handleKeepers.map((keeper) => run(keeper, type, ...rest))\n      ).then((responses) => resolve(responses.every(Boolean)))\n    })\n\n  clear = (...rest) =>\n    this.handleNodes(\n      this.getCachingNodes().map(({ id }) => id),\n      HANDLE_TYPE_DROP,\n      ...rest\n    )\n\n  getCache = (id) => this.store.get(id)\n  getNode = (id) => this.nodes.get(id)\n  getCachingNodes = () => [...this.nodes.values()]\n\n  // 静态化节点上下文内容，防止重复渲染\n  helpers = {\n    keep: this.keep,\n    update: this.update,\n    drop: this.drop,\n    dropScope: this.dropScope,\n    dropById: this.dropById,\n    dropScopeByIds: this.dropScopeByIds,\n    refresh: this.refresh,\n    refreshScope: this.refreshScope,\n    refreshById: this.refreshById,\n    refreshScopeByIds: this.refreshScopeByIds,\n    getScopeIds: this.getScopeIds,\n    clear: this.clear,\n    getCache: this.getCache,\n    getNode: this.getNode,\n    getCachingNodes: this.getCachingNodes,\n  }\n\n  render() {\n    const { children = null } = this.props\n\n    return (\n      <AliveScopeProvider value={this.helpers}>\n        {children}\n        <div style={{ display: 'none' }}>\n          {[...this.nodes.values()].map(({ children, ...props }) => (\n            <Keeper\n              key={props.id}\n              {...props}\n              scope={this}\n              store={this.store}\n              keepers={this.keepers}\n              ref={(keeper) => {\n                this.keepers.set(props.id, keeper)\n              }}\n            >\n              {children}\n            </Keeper>\n          ))}\n        </div>\n      </AliveScopeProvider>\n    )\n  }\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport React, { forwardRef, useContext } from 'react'\nimport hoistStatics from 'hoist-non-react-statics'\nimport { get, isFunction, isUndefined } from 'szfe-tools'\n\nimport { Acceptor } from './Bridge'\nimport NodeKey from './NodeKey'\nimport { AliveScopeConsumer, useScopeContext } from './context'\n\nfunction controllerCherryPick(controller) {\n  const {\n    drop,\n    dropScope,\n    refresh,\n    refreshScope,\n    clear,\n    getCachingNodes,\n  } = controller\n  return { drop, dropScope, refresh, refreshScope, clear, getCachingNodes }\n}\n\nexport const expandKeepAlive = (KeepAlive) => {\n  const renderContent = ({ idPrefix, helpers, props }) => {\n    const isOutsideAliveScope = isUndefined(helpers)\n\n    if (isOutsideAliveScope) {\n      console.error('You should not use <KeepAlive /> outside a <AliveScope>')\n    }\n\n    return isOutsideAliveScope ? (\n      get(props, 'children', null)\n    ) : (\n      <NodeKey prefix={idPrefix} key={props._nk} manualKey={props.cacheKey}>\n        {(nkId) => {\n          const id = props.cacheKey || nkId\n\n          return (\n            <Acceptor key={id} id={id}>\n              {(bridgeProps) => (\n                <KeepAlive\n                  key={id}\n                  {...props}\n                  {...bridgeProps}\n                  id={id}\n                  _helpers={helpers}\n                />\n              )}\n            </Acceptor>\n          )\n        }}\n      </NodeKey>\n    )\n  }\n  const HookExpand = ({ id: idPrefix, ...props }) =>\n    renderContent({ idPrefix, helpers: useScopeContext(), props })\n\n  const WithExpand = ({ id: idPrefix, ...props }) => (\n    <AliveScopeConsumer>\n      {(helpers) => renderContent({ idPrefix, helpers, props })}\n    </AliveScopeConsumer>\n  )\n\n  return isFunction(useContext) ? HookExpand : WithExpand\n}\n\nconst withAliveScope = (WrappedComponent) => {\n  const renderContent = ({ helpers, props, forwardedRef }) => (\n    <WrappedComponent {...props} {...helpers} ref={forwardedRef} />\n  )\n\n  const HookScope = ({ forwardedRef, ...props }) =>\n    renderContent({\n      helpers: controllerCherryPick(useScopeContext() || {}),\n      props,\n      forwardedRef,\n    })\n\n  const WithScope = ({ forwardedRef, ...props }) => (\n    <AliveScopeConsumer>\n      {(controller = {}) =>\n        renderContent({\n          helpers: controllerCherryPick(controller),\n          props,\n          forwardedRef,\n        })\n      }\n    </AliveScopeConsumer>\n  )\n\n  const HOCWithAliveScope = isFunction(useContext) ? HookScope : WithScope\n\n  if (isFunction(forwardRef)) {\n    const ForwardedRefHOC = forwardRef((props, ref) => (\n      <HOCWithAliveScope {...props} forwardedRef={ref} />\n    ))\n\n    return hoistStatics(ForwardedRefHOC, WrappedComponent)\n  } else {\n    return hoistStatics(HOCWithAliveScope, WrappedComponent)\n  }\n}\n\nexport const useAliveController = () => {\n  if (!isFunction(useContext)) {\n    return {}\n  }\n\n  const ctxValue = useScopeContext()\n\n  if (!ctxValue) {\n    return {}\n  }\n\n  return controllerCherryPick(ctxValue)\n}\n\nexport default withAliveScope\n","import {\n  globalThis as root,\n  get,\n  run,\n  value,\n  isFunction,\n  isExist,\n  flatten,\n} from 'szfe-tools'\n\nfunction isScrollableNode(node = {}) {\n  if (!isExist(node)) {\n    return false\n  }\n\n  return (\n    node.scrollWidth > node.clientWidth || node.scrollHeight > node.clientHeight\n  )\n}\n\nfunction getScrollableNodes(from) {\n  if (!isFunction(get(root, 'document.querySelectorAll'))) {\n    return []\n  }\n\n  return [...value(run(from, 'querySelectorAll', '*'), []), from].filter(\n    isScrollableNode\n  )\n}\n\nexport default function saveScrollPosition(from) {\n  const nodes = [...new Set([...flatten(from.map(getScrollableNodes))])]\n\n  const saver = nodes.map((node) => [\n    node,\n    {\n      x: node.scrollLeft,\n      y: node.scrollTop,\n    },\n  ])\n\n  return function revert() {\n    saver.forEach(([node, { x, y }]) => {\n      node.scrollLeft = x\n      node.scrollTop = y\n    })\n  }\n}\n","import React, { Component } from 'react'\nimport {\n  value,\n  get,\n  run,\n  globalThis as root,\n  nextTick,\n  isFunction,\n  isArray,\n  debounce,\n  flatten,\n} from 'szfe-tools'\n\nimport { expandKeepAlive } from './withAliveScope'\nimport {\n  LIFECYCLE_ACTIVATE,\n  LIFECYCLE_UNACTIVATE,\n  withActivation,\n} from './lifecycles'\nimport saveScrollPosition from '../helpers/saveScrollPosition'\n\nconst body = get(root, 'document.body')\nconst screenScrollingElement = get(\n  root,\n  'document.scrollingElement',\n  get(root, 'document.documentElement', {})\n)\n\nconst parseWhenResult = (res) => {\n  if (isArray(res)) {\n    return res\n  }\n\n  return [res]\n}\n\nclass KeepAlive extends Component {\n  static defaultProps = {\n    saveScrollPosition: true,\n  }\n\n  id = null // 用作 Keeper 识别 KeepAlive\n  isKeepAlive = true // 用作 Keeper 识别 KeepAlive\n  cached = false\n  constructor(props) {\n    super(props)\n    this.id = props.id\n    this.init()\n\n    // 继承响应父级 KeepAlive 的生命周期\n    ;[LIFECYCLE_ACTIVATE, LIFECYCLE_UNACTIVATE].forEach((lifecycleName) => {\n      this[lifecycleName] = () => {\n        const { id, _helpers } = this.props\n        const cache = _helpers.getCache(id)\n        const node = _helpers.getNode(id)\n        if (node && lifecycleName === LIFECYCLE_ACTIVATE) {\n          node.updateTime = Date.now()\n        }\n\n        const cached = lifecycleName === LIFECYCLE_UNACTIVATE\n\n        // 若组件即将卸载则不再触发缓存生命周期\n        if (!cache || cache.willDrop) {\n          // 若组件在父 KeepAlive 缓存期间被卸载，后续恢复后需重新触发 init\n          if (this.cached && !cached) {\n            this.init()\n          }\n          return\n        }\n\n        run(cache, lifecycleName)\n        cache.cached = cached\n        this.cached = cached\n      }\n    })\n  }\n\n  // DOM 操作将实际内容插入占位元素\n  inject = (didActivate = true) => {\n    const { id, saveScrollPosition, _helpers } = this.props\n    const cache = _helpers.getCache(id)\n    // DOM 操作有风险，try catch 护体\n    try {\n      // // 原计划不增加额外的节点，直接将 Keeper 中所有内容节点一一迁移\n      // // 后发现缺乏统一 react 认可的外层包裹，可能会造成 react dom 操作的错误\n      // // 且将导致 KeepAlive 进行 update 时需先恢复各 dom 节点的组件归属，成本过高\n      // // 故此处增加统一的 div 外层，Keeper 中与 KeepAlive 中各一个且外层不做移除处理\n      // this.parentNode = this.placeholder.parentNode\n      // cache.nodes.forEach(node => {\n      //   this.parentNode.insertBefore(node, this.placeholder)\n      // })\n      // this.parentNode.removeChild(this.placeholder)\n      // 将 AliveScopeProvider 中的渲染内容通过 dom 操作置回当前 KeepAlive\n      cache.nodes.forEach((node) => {\n        this.placeholder.appendChild(node)\n      })\n\n      if (didActivate && saveScrollPosition) {\n        // 恢复该节点下各可滚动元素的滚动位置\n        run(cache.revertScrollPos)\n      }\n    } catch (error) {\n      // console.error(error)\n    }\n  }\n\n  // DOM 操作将实际内容移出占位元素\n  eject = (willUnactivate = true) => {\n    const { id, _helpers } = this.props\n    const cache = _helpers.getCache(id)\n    const nodesNeedToSaveScrollPosition = flatten(\n      flatten([this.props.saveScrollPosition]).map((flag) => {\n        if (flag === true) {\n          return cache.nodes\n        }\n\n        if (flag === 'screen') {\n          return [screenScrollingElement, body]\n        }\n\n        return [...value(run(root, 'document.querySelectorAll', flag), [])]\n      })\n    ).filter(Boolean)\n\n    // DOM 操作有风险，try catch 护体\n    try {\n      if (willUnactivate && nodesNeedToSaveScrollPosition.length > 0) {\n        // 保存该节点下各可滚动元素的滚动位置\n        cache.revertScrollPos = saveScrollPosition(\n          nodesNeedToSaveScrollPosition\n        )\n      }\n\n      // // 原计划不增加额外的节点，直接将 Keeper 中所有内容节点一一迁移\n      // // 后发现缺乏统一 react 认可的外层包裹，可能会造成 react dom 操作的错误\n      // // 且将导致 KeepAlive 进行 update 时需先恢复各 dom 节点的组件归属，成本过高\n      // // 故此处增加统一的 div 外层，Keeper 中与 KeepAlive 中各一个且外层不做移除处理\n      // this.parentNode.insertBefore(this.placeholder, cache.nodes[0])\n      // cache.nodes.forEach(node => {\n      //   if (willUnactivate) {\n      //     this.parentNode.removeChild(node)\n      //   } else {\n      //     cache.wrapper.appendChild(node)\n      //   }\n      // })\n      // this.parentNode.insertBefore(this.placeholder, cache.nodes[0])\n      // 将 KeepAlive 中的节点恢复为原先的占位节点，保证卸载操作正常进行\n      cache.nodes.forEach((node) => {\n        if (willUnactivate) {\n          this.placeholder.removeChild(node)\n        } else {\n          cache.wrapper.appendChild(node)\n        }\n      })\n    } catch (error) {\n      // console.error(error)\n    }\n  }\n\n  init = () => {\n    const { _helpers, id, children, ...rest } = this.props\n\n    // 将 children 渲染至 AliveScopeProvider 中\n    _helpers\n      .keep(id, {\n        children,\n        getInstance: () => this,\n        ...rest,\n      })\n      .then((cache) => {\n        // fix #22\n        if (!cache) {\n          return\n        }\n\n        this.inject()\n\n        // 触发 didActivate 生命周期\n        if (cache.inited) {\n          run(this, LIFECYCLE_ACTIVATE)\n        } else {\n          cache.inited = true\n        }\n        this.cached = false\n      })\n  }\n\n  update = ({ _helpers, id, name, ...rest } = {}) => {\n    if (!_helpers || this.cached) {\n      return\n    }\n\n    // // 原先打算更新过程中先重置 dom 节点状态，更新后恢复 dom 节点\n    // // 但考虑到性能消耗可能过大，且可能因 dom 操作时机引发其他 react 渲染问题，故不使用\n    // // 对应 Keeper 处 componentDidUpdate 也注释起来不使用\n    // this.eject(false)\n    _helpers.update(id, {\n      name,\n      getInstance: () => this,\n      ...rest,\n    })\n    // this.inject(false)\n  }\n\n  // 利用 shouldComponentUpdate 提前触发组件更新\n  shouldComponentUpdate(nextProps) {\n    this.update(nextProps)\n\n    return false\n  }\n\n  // 组件卸载时重置 dom 状态，保证 react dom 操作正常进行，并触发 unactivate 生命周期\n  componentWillUnmount() {\n    const { id, _helpers, when: calcWhen = true } = this.props\n    const cache = _helpers.getCache(id)\n    const [when, isScope] = parseWhenResult(run(calcWhen))\n\n    if (!cache) {\n      return\n    }\n\n    this.eject()\n    delete cache.getInstance\n\n    if (!when) {\n      if (isScope) {\n        const needToDrop = [\n          cache,\n          ..._helpers.getScopeIds([id]).map((id) => _helpers.getCache(id)),\n        ].filter(Boolean)\n\n        needToDrop.forEach((cache) => {\n          cache.willDrop = true\n        })\n        nextTick(() => _helpers.dropScopeByIds([id]))\n      } else {\n        cache.willDrop = true\n        nextTick(() => _helpers.dropById(id))\n      }\n    }\n\n    // 触发 willUnactivate 生命周期\n    run(this, LIFECYCLE_UNACTIVATE)\n  }\n\n  render() {\n    return (\n      <div\n        key=\"keep-alive-placeholder\"\n        nodeKeyIgnore\n        className=\"ka-wrapper\"\n        ref={(node) => {\n          this.placeholder = node\n        }}\n      />\n    )\n  }\n}\n\n// 兼容 SSR 服务端渲染\nfunction SSRKeepAlive({ children }) {\n  return (\n    <div key=\"keep-alive-placeholder\" nodeKeyIgnore className=\"ka-wrapper\">\n      <div key=\"keeper-container\" nodeKeyIgnore className=\"ka-content\">\n        {children}\n      </div>\n    </div>\n  )\n}\n\nexport default isFunction(get(root, 'document.getElementById'))\n  ? expandKeepAlive(withActivation(KeepAlive))\n  : SSRKeepAlive\n"],"names":["isRegExp","val","RegExp","aliveScopeContext","createContext","AliveScopeProvider","Provider","AliveScopeConsumer","Consumer","aliveNodeContext","AliveNodeProvider","AliveNodeConsumer","eventBus","FakeScopeProvider","props","currentContextValue","value","nextProps","emit","children","Component","undefined","FakeScopeConsumer","context","nextContextValue","setState","on","updateListener","off","state","PureComponent","useScopeContext","useContext","scopeReactContext","useState","setContext","useEffect","fakeContextEventBus","React","AliveScopeReactProvider","AliveScopeReactConsumer","reactContext","Suspender","freeze","promiseCache","promise","Promise","resolve","Fragment","Freeze","placeholder","Suspense","fixedContext","updateListenerCache","Map","fixContext","ctx","includes","push","setTimeout","defaultValue","calculateChangedBits","createReactContext","tryFixCtx","type","override","configs","forEach","host","methods","method","originMethod","bind","args","_overridden","autoFixContext","err","console","warn","ProviderBridge","ctxValues","length","ctxValue","onUpdate","unmount","restValues","nextChildren","ConsumerWrapper","id","get","fn","ctxInfo","updator","set","prevValue","shouldUpdate","renderWrapper","renderContent","ctx$$","fixedContextSnapshot","RecursiveConsumerBridge","renderChildren","reduce","render","isSupported","lazy","SusNotSupported","Lazy","FallbackListener","SuspenseBridge","sus$$","onSuspenseStart","onSuspenseEnd","LazyBridge","suspense","ErrorBoundaryBridge","error","throwError","error$$","ErrorThrower","cb","Bridge","bridgeProps","Acceptor","ConsumerBridge","LIFECYCLE_ACTIVATE","LIFECYCLE_UNACTIVATE","withActivation","WrappedComponent","HOC","drop","forwardedRef","attach","ref","every","lifecycleName","current","prototype","componentDidMount","_componentDidMount","call","forwardRef","ForwardedRefHOC","hoistStatics","useActivation","funcName","func","useRef","some","useActivate","useUnactivate","ReactFreeze","Keeper","rest","nextState","callback","unmounted","listeners","isKeepAlive","store","cache","aliveNodesId","Set","delay","timeout","scope","clearTimeout","willDrop","nodes","helpers","smartForceUpdate","canDrop","canRefresh","safeSetState","key","Math","random","node","wrapper","has","e","inited","cached","keepers","appendChild","freezeTimeout","listener","reverse","flushSync","autoFreeze","contextValue","Children","map","child","idx","cloneElement","HANDLE_TYPE_DROP","HANDLE_TYPE_REFRESH","AliveScope","forceUpdate","updateCallbackList","debouncedForceUpdate","params","keeper","isNew","now","Date","createTime","updateTime","update","then","name","getCachingNodes","filter","test","ids","getCachingNodesId","getCache","size","handleNodes","getScopeIds","getCachingNodesByName","dropScopeByIds","refreshScopeByIds","nodesId","handleKeepers","all","responses","Boolean","values","keep","dropScope","dropById","refresh","refreshScope","refreshById","clear","getNode","display","controllerCherryPick","controller","expandKeepAlive","KeepAlive","idPrefix","isOutsideAliveScope","_nk","cacheKey","nkId","HookExpand","WithExpand","withAliveScope","HookScope","WithScope","HOCWithAliveScope","useAliveController","isScrollableNode","scrollWidth","clientWidth","scrollHeight","clientHeight","getScrollableNodes","from","saveScrollPosition","saver","x","scrollLeft","y","scrollTop","revert","body","screenScrollingElement","parseWhenResult","res","didActivate","_helpers","revertScrollPos","willUnactivate","nodesNeedToSaveScrollPosition","flag","removeChild","getInstance","inject","init","when","calcWhen","isScope","eject","needToDrop","SSRKeepAlive"],"mappings":"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"}