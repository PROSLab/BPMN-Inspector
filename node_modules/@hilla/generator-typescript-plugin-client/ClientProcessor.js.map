{"version":3,"file":"ClientProcessor.js","sourceRoot":"","sources":["src/ClientProcessor.ts"],"names":[],"mappings":"AACA,OAAO,2BAA2B,MAAM,kEAAkE,CAAC;AAC3G,OAAO,gBAAgB,MAAM,uDAAuD,CAAC;AACrF,OAAO,iBAAiB,MAAM,qEAAqE,CAAC;AACpG,OAAO,WAAW,MAAM,+DAA+D,CAAC;AAExF,OAAO,EAAE,MAAM,YAAY,CAAC;AAE5B,MAAM,CAAC,OAAO,OAAO,eAAe;IACzB,SAAS,CAAS;IAClB,MAAM,CAAS;IAExB,YAAmB,QAAgB,EAAE,KAAa;QAChD,IAAI,CAAC,SAAS,GAAG,IAAI,WAAW,CAAC,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC,kBAAkB,CAAC,QAAQ,CAAC,CAAC;QACnF,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;IACtB,CAAC;IAEM,OAAO;QACZ,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,cAAc,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC;QAEzD,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,IAAI,iBAAiB,CAAC,IAAI,WAAW,EAAE,CAAC,CAAC;QAC7E,MAAM,aAAa,GAAG,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,oBAAoB,CAAC,iBAAiB,EAAE,KAAK,CAAC,EAAE,eAAe,CAAC,CAAC;QAE/G,MAAM,WAAW,GAAG,2BAA2B,CAAC,QAAQ,CAAC,CAAC;QAC1D,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;QAEjC,MAAM,WAAW,GAAG,EAAE,CAAC,OAAO,CAAC,uBAAuB,CACpD,SAAS,EACT,EAAE,CAAC,OAAO,CAAC,6BAA6B,CACtC;YACE,EAAE,CAAC,OAAO,CAAC,yBAAyB,CAClC,WAAW,EACX,SAAS,EACT,SAAS,EACT,EAAE,CAAC,OAAO,CAAC,mBAAmB,CAAC,aAAa,EAAE,SAAS,EAAE;gBACvD,EAAE,CAAC,OAAO,CAAC,6BAA6B,CACtC;oBACE,EAAE,CAAC,OAAO,CAAC,wBAAwB,CACjC,EAAE,CAAC,OAAO,CAAC,gBAAgB,CAAC,QAAQ,CAAC,EACrC,EAAE,CAAC,OAAO,CAAC,mBAAmB,CAAC,SAAS,CAAC,CAC1C;iBACF,EACD,KAAK,CACN;aACF,CAAC,CACH;SACF,EACD,EAAE,CAAC,SAAS,CAAC,KAAK,CACnB,CACF,CAAC;QAEF,OAAO,gBAAgB,CAAC,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,EAAE,WAAW,EAAE,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;IACnG,CAAC;CACF","sourcesContent":["import type Plugin from '@hilla/generator-typescript-core/Plugin.js';\nimport createFullyUniqueIdentifier from '@hilla/generator-typescript-utils/createFullyUniqueIdentifier.js';\nimport createSourceFile from '@hilla/generator-typescript-utils/createSourceFile.js';\nimport DependencyManager from '@hilla/generator-typescript-utils/dependencies/DependencyManager.js';\nimport PathManager from '@hilla/generator-typescript-utils/dependencies/PathManager.js';\nimport type { SourceFile } from 'typescript';\nimport ts from 'typescript';\n\nexport default class ClientProcessor {\n  readonly #filePath: string;\n  readonly #owner: Plugin;\n\n  public constructor(fileName: string, owner: Plugin) {\n    this.#filePath = new PathManager({ extension: 'ts' }).createRelativePath(fileName);\n    this.#owner = owner;\n  }\n\n  public process(): SourceFile {\n    this.#owner.logger.debug(`Generating ${this.#filePath}`);\n\n    const { exports, imports, paths } = new DependencyManager(new PathManager());\n    const clientClassId = imports.named.add(paths.createBareModulePath('@hilla/frontend', false), 'ConnectClient');\n\n    const clientVarId = createFullyUniqueIdentifier('client');\n    exports.default.set(clientVarId);\n\n    const declaration = ts.factory.createVariableStatement(\n      undefined,\n      ts.factory.createVariableDeclarationList(\n        [\n          ts.factory.createVariableDeclaration(\n            clientVarId,\n            undefined,\n            undefined,\n            ts.factory.createNewExpression(clientClassId, undefined, [\n              ts.factory.createObjectLiteralExpression(\n                [\n                  ts.factory.createPropertyAssignment(\n                    ts.factory.createIdentifier('prefix'),\n                    ts.factory.createStringLiteral('connect'),\n                  ),\n                ],\n                false,\n              ),\n            ]),\n          ),\n        ],\n        ts.NodeFlags.Const,\n      ),\n    );\n\n    return createSourceFile([...imports.toCode(), declaration, ...exports.toCode()], this.#filePath);\n  }\n}\n"]}